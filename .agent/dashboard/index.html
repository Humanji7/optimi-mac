<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè• Projects Health Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1>üè• Projects Health Dashboard</h1>
                <div class="header-actions">
                    <label class="auto-refresh-toggle">
                        <input type="checkbox" id="autoRefreshToggle">
                        <span class="toggle-label">Auto-refresh</span>
                        <span class="countdown" id="countdown"></span>
                    </label>
                    <div class="last-updated" id="lastUpdated">
                        <span class="pulse"></span>
                        <span>Last scan: Loading...</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Summary Cards -->
        <section class="summary-section">
            <div class="summary-grid">
                <div class="summary-card total">
                    <div class="card-icon">üìÅ</div>
                    <div class="card-content">
                        <span class="card-value" id="totalProjects">--</span>
                        <span class="card-label">Total Projects</span>
                    </div>
                </div>

                <div class="summary-card healthy">
                    <div class="card-icon">‚úÖ</div>
                    <div class="card-content">
                        <span class="card-value" id="healthyProjects">--</span>
                        <span class="card-label">Healthy</span>
                    </div>
                    <div class="card-progress">
                        <div class="progress-bar" id="healthyBar"></div>
                    </div>
                </div>

                <div class="summary-card agent">
                    <div class="card-icon">ü§ñ</div>
                    <div class="card-content">
                        <span class="card-value" id="withAgent">--</span>
                        <span class="card-label">With .agent/</span>
                    </div>
                    <div class="card-progress">
                        <div class="progress-bar" id="agentBar"></div>
                    </div>
                </div>

                <div class="summary-card hooks">
                    <div class="card-icon">ü™ù</div>
                    <div class="card-content">
                        <span class="card-value" id="activeHooks">--</span>
                        <span class="card-label">Active HOOKs</span>
                    </div>
                </div>

                <div class="summary-card warning">
                    <div class="card-icon">‚ö†Ô∏è</div>
                    <div class="card-content">
                        <span class="card-value" id="uncommitted">--</span>
                        <span class="card-label">Uncommitted</span>
                    </div>
                </div>

                <div class="summary-card attention">
                    <div class="card-icon">üö®</div>
                    <div class="card-content">
                        <span class="card-value" id="needsAttention">--</span>
                        <span class="card-label">Need Attention</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Projects Tables -->
        <section class="projects-section">
            <!-- Healthy Projects -->
            <div class="table-container healthy-table">
                <h2>‚úÖ Healthy Projects</h2>
                <table id="healthyTable">
                    <thead>
                        <tr>
                            <th>Project</th>
                            <th>.agent/</th>
                            <th>HOOK</th>
                            <th>Git Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic content -->
                    </tbody>
                </table>
                <div class="empty-state" id="healthyEmpty">
                    <span>No healthy projects found</span>
                </div>
            </div>

            <!-- Working Projects -->
            <div class="table-container working-table">
                <h2>üî® Working Projects</h2>
                <table id="workingTable">
                    <thead>
                        <tr>
                            <th>Project</th>
                            <th>HOOK</th>
                            <th>Git Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic content -->
                    </tbody>
                </table>
                <div class="empty-state" id="workingEmpty">
                    <span>No projects in progress</span>
                </div>
            </div>

            <!-- Attention Projects -->
            <div class="table-container attention-table">
                <h2>‚ö†Ô∏è Projects Needing Attention</h2>
                <table id="attentionTable">
                    <thead>
                        <tr>
                            <th>Project</th>
                            <th>Issues</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic content -->
                    </tbody>
                </table>
                <div class="empty-state" id="attentionEmpty">
                    <span>All projects are healthy! üéâ</span>
                </div>
            </div>
        </section>

        <!-- Recommendations -->
        <section class="recommendations-section">
            <h2>üí° Recommendations</h2>
            <ul id="recommendationsList" class="recommendations-list">
                <!-- Dynamic content -->
            </ul>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>Generated by <code>projects-health-check.sh</code></p>
            <div class="actions-container">
                <button class="refresh-btn" id="refreshBtn">
                    üîÑ Refresh
                </button>
                <button class="night-watch-btn" id="nightWatchBtn"
                    title="Run overnight refactoring on Working projects">
                    üåô Night Watch
                </button>
                <button class="statusline-btn" id="statusLineBtn" title="Install Smart StatusLine for Claude Code">
                    üìä StatusLine
                </button>
                <button class="setup-ai-btn" id="setupAIBtn" title="Setup unified AI infrastructure">
                    üèóÔ∏è Setup AI
                </button>
                <div class="dropdown" id="actionsDropdown">
                    <button class="dropdown-toggle" id="actionsToggle">
                        ‚ö° Actions ‚ñæ
                    </button>
                    <div class="dropdown-menu" id="actionsMenu">
                        <button class="dropdown-item" id="runHealthCheck">
                            üè• Run Health Check
                        </button>
                        <button class="dropdown-item" id="copyReport">
                            üìã Copy Report Path
                        </button>
                        <button class="dropdown-item" id="openTerminal">
                            üíª Open Terminal Command
                        </button>
                        <button class="dropdown-item" id="nightWatchDryRun">
                            üîç Night Watch (Dry Run)
                        </button>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- HOOK Details Modal -->
    <div class="modal-overlay" id="hookModal">
        <div class="modal">
            <div class="modal-header">
                <h3>ü™ù Active HOOKs</h3>
                <button class="modal-close" id="closeHookModal">&times;</button>
            </div>
            <div class="modal-body" id="hookModalBody">
                <!-- Dynamic content -->
            </div>
            <div class="modal-footer">
                <button class="modal-btn" id="closeModalBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Night Watch Modal -->
    <div class="modal-overlay" id="nightWatchModal">
        <div class="modal night-watch-modal">
            <div class="modal-header">
                <h3>üåô Night Watch</h3>
                <button class="modal-close" id="closeNightWatchModal">&times;</button>
            </div>
            <div class="modal-body" id="nightWatchModalBody">
                <p class="night-watch-intro">Select projects for overnight refactoring:</p>
                <div class="project-checklist" id="projectChecklist">
                    <!-- Dynamic checkboxes -->
                </div>
                <div class="night-watch-info">
                    <p>‚ö†Ô∏è All changes go to separate branches</p>
                    <p>üìÅ Branch: <code>refactor/night-watch-YYYYMMDD</code></p>
                </div>
            </div>
            <div class="modal-footer night-watch-footer">
                <label class="select-all-label">
                    <input type="checkbox" id="selectAllProjects"> Select all
                </label>
                <div class="modal-actions">
                    <button class="modal-btn secondary" id="nightWatchDryRunBtn">üîç Dry Run</button>
                    <button class="modal-btn primary" id="nightWatchRunBtn">üåô Start</button>
                </div>
            </div>
        </div>
    </div>

    <!-- StatusLine Install Modal -->
    <div class="modal-overlay" id="statusLineModal">
        <div class="modal statusline-modal">
            <div class="modal-header">
                <h3>üìä Smart StatusLine</h3>
                <button class="modal-close" id="closeStatusLineModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="statusline-intro">
                    Shows context usage with color-coded alerts.
                    Warns at 90%+ with sound & notification.
                </p>
                <div class="statusline-preview">
                    <code class="preview-green">‚úì 45% [‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] 90k/200k</code>
                    <code class="preview-yellow">‚ö†Ô∏è 82% [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë] 165k/200k</code>
                    <code class="preview-red">üö® 92% [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë] 185k/200k ROLLOVER!</code>
                </div>
                <div class="install-steps">
                    <p><strong>One-click install:</strong></p>
                    <div class="command-box" id="statusLineCommand">
                        curl -fsSL
                        https://raw.githubusercontent.com/Humanji7/optimi-mac/main/.agent/scripts/install-statusline.sh
                        | bash
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" id="copyStatusLineCmd">üìã Copy Command</button>
                <button class="modal-btn primary" id="installStatusLine">‚ö° Install Now</button>
            </div>
        </div>
    </div>

    <!-- Setup AI Infrastructure Modal -->
    <div class="modal-overlay" id="setupAIModal">
        <div class="modal setup-ai-modal">
            <div class="modal-header">
                <h3>üèóÔ∏è AI Infrastructure Setup</h3>
                <button class="modal-close" id="closeSetupAIModal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="setup-ai-intro">
                    Create unified AI agent config with <strong>Single Source of Truth</strong> in
                    <code>.agent/MAIN.md</code>
                </p>
                <div class="setup-ai-benefits">
                    <div class="benefit-item">‚úÖ No more duplication (CLAUDE.md, AGENTS.md, .cursorrules)</div>
                    <div class="benefit-item">‚úÖ GUPP protocol for persistent state</div>
                    <div class="benefit-item">‚úÖ Works with Claude Code, Codex, Cursor</div>
                </div>
                <div class="setup-ai-structure">
                    <p><strong>Creates:</strong></p>
                    <pre class="structure-preview">.agent/
‚îú‚îÄ‚îÄ MAIN.md           # Single Source of Truth
‚îú‚îÄ‚îÄ docs/             # Architecture, conventions
‚îú‚îÄ‚îÄ workflows/        # /command workflows
‚îî‚îÄ‚îÄ scripts/          # Automation

CLAUDE.md             # ‚Üí Redirect to .agent/MAIN.md
AGENTS.md             # ‚Üí Redirect to .agent/MAIN.md
.cursorrules          # ‚Üí Redirect to .agent/MAIN.md</pre>
                </div>
                <div class="install-steps">
                    <p><strong>For selected project:</strong></p>
                    <div class="project-selector">
                        <select id="setupAIProjectSelect">
                            <!-- Dynamic options -->
                        </select>
                    </div>
                    <div class="command-box" id="setupAICommand">
                        bash ~/projects/optimi-mac/.agent/scripts/setup-ai-infrastructure.sh ~/projects/PROJECT
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn secondary" id="setupAIDryRun">üîç Dry Run</button>
                <button class="modal-btn primary" id="copySetupAICmd">üìã Copy Command</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>